name: Trivy Docker Scan

on:
  push:
    branches: [ main ]

jobs:
  trivy-scan:
    runs-on: ubuntu-latest

    steps:
- name: Checkout cÃ³digo
  uses: actions/checkout@v3
  with:
    fetch-depth: 0

    - name: Instalar Trivy
      run: |
curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh

    - name: Baixar imagem do Juice Shop
      run: docker pull bkimminich/juice-shop

    - name: Rodar Trivy na imagem Docker
      run: |
        mkdir -p relatorios
        trivy image bkimminich/juice-shop > relatorios/trivy-result.txt || echo "Trivy falhou"

    - name: Verificar resultado
      run: cat relatorios/trivy-result.txt
